<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Todo List Daily (Dark Theme)</title>
  <style>
    /* Основные стили для тёмной темы */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 300;
    }
    /* Стили для формы */
    form {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    form input[type="text"] {
      width: 300px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #444;
      border-radius: 5px;
      background-color: #1e1e1e;
      color: #e0e0e0;
    }
    form button {
      margin-left: 10px;
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #3a3a3a;
      color: #e0e0e0;
      transition: background-color 0.2s ease;
    }
    form button:hover {
      background-color: #555;
    }
    /* Кнопка отмены редактирования */
    #cancel-btn {
      background-color: #c0392b;
    }
    #cancel-btn:hover {
      background-color: #e74c3c;
    }
    /* Контейнер для задач */
    #tasks-container {
      max-width: 500px;
      margin: 0 auto;
      background-color: #1e1e1e;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    /* Стили для отдельной задачи */
    .task {
      display: flex;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #333;
    }
    .task:last-child {
      border-bottom: none;
    }
    .task.done label {
      text-decoration: line-through;
      color: #888;
    }
    .task label {
      flex-grow: 1;
      cursor: pointer;
      padding: 0 10px;
    }
    .task button {
      margin-left: 10px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #3a3a3a;
      color: #e0e0e0;
      padding: 5px 10px;
      transition: background-color 0.2s ease;
    }
    .task button:hover {
      background-color: #555;
    }
    .hidden {
      display: none;
    }
    /* Стили для чекбокса */
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #3a3a3a;
    }
  </style>
</head>
<body>
  <h1>Todo List Daily</h1>
  
  <!-- Форма добавления/редактирования задачи -->
  <form id="task-form">
    <!-- Скрытое поле для хранения id задачи при редактировании -->
    <input type="hidden" id="task-id">
    <input type="text" id="task-input" placeholder="Введите задачу" required>
    <button type="submit">Сохранить</button>
    <button type="button" id="cancel-btn" class="hidden">Отмена</button>
  </form>
  
  <!-- Контейнер для списка задач -->
  <div id="tasks-container"></div>
  
  <script>
    // Ключи для localStorage
    const TASKS_KEY = 'tasks';
    const LAST_RESET_KEY = 'lastResetDate';
    
    // Массив задач
    let tasks = [];
    // Глобальный счётчик для определения порядка задач
    let nextOrder = 1;
    
    // Функция сохранения задач в localStorage
    function saveTasks() {
      localStorage.setItem(TASKS_KEY, JSON.stringify(tasks));
    }
    
    // Функция загрузки задач из localStorage и инициализация nextOrder
    function loadTasks() {
      const tasksStr = localStorage.getItem(TASKS_KEY);
      tasks = tasksStr ? JSON.parse(tasksStr) : [];
      
      // Если задачи загружены, проверяем наличие order и определяем nextOrder
      if (tasks.length > 0) {
        let maxOrder = 0;
        tasks.forEach(task => {
          // Если поле order отсутствует (для совместимости со старыми данными)
          if (typeof task.order === 'undefined') {
            task.order = task.id;
          }
          if (task.order > maxOrder) {
            maxOrder = task.order;
          }
        });
        nextOrder = maxOrder + 1;
      } else {
        nextOrder = 1;
      }
    }
    
    // Получаем сегодняшнюю дату в формате YYYY-MM-DD
    function getTodayString() {
      const now = new Date();
      return now.toISOString().split('T')[0];
    }
    
    // Сброс флажков выполнения, если наступил новый день
    function resetTasksIfNeeded() {
      const today = getTodayString();
      const lastReset = localStorage.getItem(LAST_RESET_KEY);
      if (lastReset !== today) {
        tasks.forEach(task => task.done = false);
        localStorage.setItem(LAST_RESET_KEY, today);
        saveTasks();
      }
    }
    
    // Функция рендеринга задач. Сортировка происходит по значению order
    function renderTasks() {
      const container = document.getElementById('tasks-container');
      container.innerHTML = '';
      
      const sortedTasks = tasks.slice().sort((a, b) => a.order - b.order);
      
      sortedTasks.forEach(task => {
        const taskDiv = document.createElement('div');
        taskDiv.className = 'task' + (task.done ? ' done' : '');
        
        // Чекбокс для отметки выполнения
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = task.done;
        checkbox.addEventListener('change', function() {
          if (checkbox.checked) {
            // При установке флажка: помечаем задачу выполненной и обновляем порядок,
            // чтобы переместить её в конец
            task.done = true;
            task.order = nextOrder++;
          } else {
            // При снятии флажка: задача становится не выполненной, но её order не меняется,
            // поэтому она остаётся на своём месте
            task.done = false;
          }
          saveTasks();
          renderTasks();
        });
        taskDiv.appendChild(checkbox);
        
        // Метка с текстом задачи. При клике запускается режим редактирования.
        const label = document.createElement('label');
        label.textContent = task.content;
        label.addEventListener('click', function() {
          // Режим редактирования: заполняем форму данными задачи
          document.getElementById('task-id').value = task.id;
          document.getElementById('task-input').value = task.content;
          document.getElementById('cancel-btn').classList.remove('hidden');
          document.getElementById('task-input').focus();
        });
        taskDiv.appendChild(label);
        
        // Кнопка для удаления задачи
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Удалить';
        deleteBtn.addEventListener('click', function() {
          tasks = tasks.filter(t => t.id !== task.id);
          saveTasks();
          renderTasks();
        });
        taskDiv.appendChild(deleteBtn);
        
        container.appendChild(taskDiv);
      });
    }
    
    // Обработка отправки формы (добавление или редактирование задачи)
    document.getElementById('task-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const taskInput = document.getElementById('task-input');
      const taskIdInput = document.getElementById('task-id');
      const content = taskInput.value.trim();
      if (content === '') return;
      
      if (taskIdInput.value) {
        // Режим редактирования: обновляем задачу
        const task = tasks.find(t => t.id == taskIdInput.value);
        if (task) {
          task.content = content;
        }
      } else {
        // Режим создания: добавляем новую задачу с порядковым номером order
        const newTask = {
          id: Date.now(),
          content: content,
          done: false,
          order: nextOrder++
        };
        tasks.push(newTask);
      }
      
      saveTasks();
      renderTasks();
      
      // Сброс формы
      taskInput.value = '';
      taskIdInput.value = '';
      document.getElementById('cancel-btn').classList.add('hidden');
    });
    
    // Обработка кнопки "Отмена" для отмены редактирования
    document.getElementById('cancel-btn').addEventListener('click', function() {
      document.getElementById('task-id').value = '';
      document.getElementById('task-input').value = '';
      document.getElementById('cancel-btn').classList.add('hidden');
    });
    
    // Инициализация: загрузка задач, сброс флажков при новом дне и рендеринг списка
    loadTasks();
    resetTasksIfNeeded();
    renderTasks();
  </script>
</body>
</html>